<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">تمرین</title>

    <link rel="stylesheet" href="../../../../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="../../../../static/js/submit_answers.js" defer></script>
    <script src="../../../../static/js/tetris_python.js" defer></script>

    <style>
        #tetrisCanvas {
            width: 100%;
            height: auto;
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="../../index.html">خانه</a></li>
                <li><a href="../index.html">پایتون</a></li>
            </ul>
        </nav>
    </header>
    <div class="container">
        <h1 id="main-header">تمرین</h1>
        <canvas id="tetrisCanvas"></canvas>
        
        <!-- User Information -->
        <form id="user-info-form" action="javascript:void(0);" onsubmit="saveUserInfo(event)">
            <div class="form-group">
                <label for="name">نام:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="password">کلمه عبور:</label>
                <input type="password" id="password" name="password" required>
            </div>

            <div class="submit-button">
                <input type="submit" value="ثبت اطلاعات">
            </div>
        </form>

        <!-- Questions Container -->
        <div id="questions-container"></div>

        <div class="submit-button">
            <button onclick="submitAllAnswers()">ارسال تمام پاسخ‌ها</button>
        </div>
    </div>

    <script>
        // Function to create and append a script element for the Gists
        function appendGistScript(src) {
            const script = document.createElement('script');
            script.src = src;
            document.body.appendChild(script);
        }

        // Fetch the JSON file and update the HTML content
        fetch('../../../../data/python/questions/post_7.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Set the page title and header from metadata
                document.getElementById('page-title').textContent = data.metadata.title;
                document.getElementById('main-header').textContent = data.metadata.title;

                // Generate and insert the questions into the container
                const questionsContainer = document.getElementById('questions-container');
                
                let counter = 1; // Initialize a counter for incremental numbering

                data.questions.forEach(question => {
                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('question');
                    
                    // Insert question content and increment the counter
                    questionDiv.innerHTML = `
                        <h2>${counter}. ${question.title}</h2>
                        ${question.content}
                    `;
                    counter++;

                    // Append the new question to the container
                    questionsContainer.appendChild(questionDiv);

                    // If the content contains a Gist script, append it
                    const scriptMatch = question.content.match(/<script src="(.+?)"><\/script>/);
                    if (scriptMatch) {
                        appendGistScript(scriptMatch[1]);
                    }
                });
            })
            .catch(error => console.error('Error fetching JSON:', error));
    </script>
</body>
</html>
